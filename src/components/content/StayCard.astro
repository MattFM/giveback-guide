---
import ResponsiveImage from '../ui/Image/ResponsiveImage.astro';
import BaseCard from '../ui/BaseCard.astro';
import VerificationPill from './VerificationPill.astro';

interface Props { stay: any }
const { stay } = Astro.props as Props;
---

<BaseCard>
  <div class="relative">
        <a href={`/stays/${stay.data.properties.sSlug}/`}>
          <ResponsiveImage
            class="w-full rounded-lg h-64 mb-3 object-cover"
            src={stay.data.properties.sImageURL1}
            alt=""
            preset="card"
            fallbackWidth={600}
            transitionName={`stay-${stay.data.properties.sSlug}`}
          />
          {
            (stay.data.properties.sVerify || stay.data.properties.sFree) && (
              <div class="absolute top-2 left-2 flex items-start gap-2">
                <VerificationPill status={stay.data.properties.sVerify} />
                {stay.data.properties.sFree && (
                  <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-amber-800 bg-amber-100 rounded-full border border-amber-200 shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="currentColor">
                      <path d="M444-200h70v-50q50-9 86-39t36-89q0-42-24-77t-96-61q-60-20-83-35t-23-41q0-26 18.5-41t53.5-15q32 0 50 15.5t26 38.5l64-26q-11-35-40.5-61T516-710v-50h-70v50q-50 11-78 44t-28 74q0 47 27.5 76t86.5 50q63 23 87.5 41t24.5 47q0 33-23.5 48.5T486-314q-33 0-58.5-20.5T390-396l-66 26q14 48 43.5 77.5T444-252v52Zm36 120q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"/>
                    </svg>
                    <span class="text-xs font-semibold">Free</span>
                  </span>
                )}
              </div>
            )
          }
        </a>
        </div>
        <div class="absolute top-2 right-2">
          <!-- Save control removed from card; Save UI is available on stay pages only -->
        </div>
  <div class="mb-2 flex items-center flex-wrap gap-1.5">
    {
      (() => {
        const countries = stay.data.properties.sCountry;
        const countryArray = Array.isArray(countries) ? countries : [countries];
        const locales = stay.data.properties.sLocale;
        const localeArray = Array.isArray(locales) ? locales : [locales];
        
        // Format locales based on count
        const formatLocales = (locales: string[]) => {
          if (locales.length === 0) return "";
          if (locales.length === 1) return locales[0];
          if (locales.length === 2) return `${locales[0]} & ${locales[1]}`;
          if (locales.length === 3) return `${locales[0]}, ${locales[1]} & ${locales[2]}`;
          // For 4+, show first two and count remaining
          const remaining = locales.length - 2;
          return `${locales[0]}, ${locales[1]} & ${remaining} more`;
        };
        
        return countryArray
          .filter((country: string) => country !== "United Kingdom" && country !== "UK")
          .map((country: string) => (
            <div class="inline-flex items-center gap-1.5">
              <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium border border-gray-300 text-gray-700 dark:border-gray-600 dark:text-gray-300">
                {country}
              </span>
              {localeArray.length > 0 && (
                <span class="text-xs font-medium text-gray-700 dark:text-gray-300">
                  |&nbsp; {formatLocales(localeArray)}
                </span>
              )}
            </div>
          ));
      })()
    }
  </div>
  <h2 class="mb-2 text-2xl font-medium tracking-tight text-gray-900 dark:text-white line-clamp-3">
    <a href={`/stays/${stay.data.properties.sSlug}/`} style={`view-transition-name: stay-title-${stay.data.properties.sSlug}`}>
      {stay.data.properties.sTitle}
    </a>
  </h2>
  <p class="mt-2 text-sm font-normal text-gray-400 dark:text-gray-400">
    {stay.data.properties.sName} is a {stay.data.properties.sType}
  </p>
</BaseCard>