---
import ResponsiveImage from '../ui/Image/ResponsiveImage.astro';
import BaseCard from '../ui/BaseCard.astro';

interface Props { stay: any }
const { stay } = Astro.props as Props;
---

<BaseCard>
  <div class="relative">
        <a href={`/stays/${stay.data.properties.sSlug}/`}>
          <ResponsiveImage
            class="w-full rounded-lg h-64 mb-3 object-cover"
            src={stay.data.properties.sImageURL1}
            alt=""
            preset="card"
            fallbackWidth={600}
          />
          {stay.data.properties.sVerify && (
            <div class="absolute top-2 left-2">
              <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-green-800 bg-green-100 rounded-full border border-green-200 shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="currentColor">
                  <path d="m346-60-76-130-151-31 17-147-96-112 96-111-17-147 151-31 76-131 134 62 134-62 77 131 150 31-17 147 96 111-96 112 17 147-150 31-77 130-134-62-134 62Zm91-287 227-225-45-41-182 180-95-99-46 45 141 140Z"/>
                </svg>
                <span class="text-xs font-semibold">Verified</span>
              </span>
            </div>
          )}
        </a>
        </div>
        <div class="absolute top-2 right-2">
          <!-- Save control removed from card; Save UI is available on stay pages only -->
        </div>
  <div class="mb-2">
    {
      (() => {
        const countries = stay.data.properties.sCountry;
        const countryArray = Array.isArray(countries) ? countries : [countries];
        
        return countryArray
          .filter((country: string) => country !== "United Kingdom" && country !== "UK")
          .map((country: string) => (
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium border border-gray-300 text-gray-700 dark:border-gray-600 dark:text-gray-300 mr-1.5">
              {country}
            </span>
          ));
      })()
    }
  </div>
  <h2 class="mb-2 text-2xl font-medium tracking-tight text-gray-900 dark:text-white line-clamp-3">
    <a href={`/stays/${stay.data.properties.sSlug}/`}>
      {stay.data.properties.sTitle}
    </a>
  </h2>
  <p class="mt-2 text-sm font-normal text-gray-400 dark:text-gray-400">
    {stay.data.properties.sName} is a {stay.data.properties.sType} in
    {
      (() => {
        const locales = stay.data.properties.sLocale;
        
        // Format locales
        if (Array.isArray(locales)) {
          if (locales.length === 0) return "";
          if (locales.length === 1) return locales[0];
          if (locales.length === 2) return `${locales[0]} & ${locales[1]}`;
          return locales.slice(0, -1).join(", ") + " & " + locales[locales.length - 1];
        }
        return locales;
      })()
    }
  </p>
</BaseCard>