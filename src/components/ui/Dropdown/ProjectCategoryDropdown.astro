---
import { getCollection } from "astro:content";
import CustomDropdown from "./CustomDropdown.astro";

const projects = await getCollection("projects");

// Count the number of projects for each category
const categoryCounts = projects.reduce((acc: Record<string, number>, project) => {
  const categories = Array.isArray(project.data.properties.pCategory)
    ? project.data.properties.pCategory
    : [project.data.properties.pCategory];

  categories.forEach((category) => {
    if (category) {
      acc[category] = (acc[category] || 0) + 1;
    }
  });

  return acc;
}, {});

// Extract unique categories and sort alphabetically
const uniqueCategories = Object.keys(categoryCounts).sort();

// Transform to items array for CustomDropdown
const items = uniqueCategories.map((category) => {
  const categorySlug = category.toLowerCase().replace(/\s+/g, "-");
  return {
    name: category,
    count: categoryCounts[category],
    url: `/projects/category/${categorySlug}`,
  };
});
---

<CustomDropdown
  buttonText="Categories"
  items={items}
  buttonId="category-dropdown-button"
  dropdownId="category-dropdown-menu"
/>