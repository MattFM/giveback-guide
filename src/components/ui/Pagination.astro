---
interface Props {
  currentPage: number;
  lastPage: number;
  prevUrl?: string;
  nextUrl?: string;
  baseUrl: string; // e.g., "/projects" or "/blog"
}

const { currentPage, lastPage, prevUrl, nextUrl, baseUrl } = Astro.props;

// Generate page numbers to display
function generatePageNumbers(current: number, total: number): (number | 'ellipsis')[] {
  const pages: (number | 'ellipsis')[] = [];
  
  // Always show first page
  pages.push(1);
  
  if (total <= 7) {
    // Show all pages if 7 or fewer
    for (let i = 2; i <= total; i++) {
      pages.push(i);
    }
  } else {
    // Show smart pagination with ellipsis
    if (current <= 3) {
      // Near start: 1 2 3 4 ... last
      for (let i = 2; i <= 4; i++) {
        pages.push(i);
      }
      pages.push('ellipsis');
      pages.push(total);
    } else if (current >= total - 2) {
      // Near end: 1 ... last-3 last-2 last-1 last
      pages.push('ellipsis');
      for (let i = total - 3; i <= total; i++) {
        pages.push(i);
      }
    } else {
      // Middle: 1 ... current-1 current current+1 ... last
      pages.push('ellipsis');
      pages.push(current - 1);
      pages.push(current);
      pages.push(current + 1);
      pages.push('ellipsis');
      pages.push(total);
    }
  }
  
  return pages;
}

const pageNumbers = generatePageNumbers(currentPage, lastPage);

// Helper to generate page URL
function getPageUrl(pageNum: number): string {
  if (pageNum === 1) {
    return `${baseUrl}/`;
  }
  return `${baseUrl}/${pageNum}/`;
}
---

<nav aria-label="Pagination" class="flex justify-center items-center gap-1">
  <!-- Previous Button -->
  {prevUrl ? (
    <a
      href={prevUrl}
      class="flex items-center justify-center px-2.5 sm:px-3 h-10 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-black dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors cursor-pointer"
      aria-label="Previous page"
    >
      <svg class="w-3.5 h-3.5 sm:me-2 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5H1m0 0 4 4M1 5l4-4"/>
      </svg>
      <span class="hidden sm:inline">Previous</span>
    </a>
  ) : (
    <span
      class="flex items-center justify-center px-2.5 sm:px-3 h-10 text-sm font-medium text-gray-400 bg-gray-100 border border-gray-200 rounded-lg cursor-not-allowed dark:bg-gray-800 dark:border-gray-700 dark:text-gray-600"
      aria-disabled="true"
      aria-label="Previous page (disabled)"
    >
      <svg class="w-3.5 h-3.5 sm:me-2 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5H1m0 0 4 4M1 5l4-4"/>
      </svg>
      <span class="hidden sm:inline">Previous</span>
    </span>
  )}

  <!-- Page Numbers -->
  <div class="flex items-center gap-1 mx-2">
    {pageNumbers.map((pageNum) => {
      if (pageNum === 'ellipsis') {
        return (
          <span class="flex items-center justify-center px-3 h-10 text-sm font-medium text-gray-500 dark:text-gray-400">
            ...
          </span>
        );
      }
      
      const isCurrent = pageNum === currentPage;
      
      return (
        <a
          href={getPageUrl(pageNum)}
          class={isCurrent 
            ? "flex items-center justify-center px-3 h-10 text-sm font-semibold text-white bg-black border border-black rounded-lg hover:bg-gray-800 dark:bg-gray-700 dark:border-gray-700 dark:hover:bg-gray-600 cursor-pointer"
            : "flex items-center justify-center px-3 h-10 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-black dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors cursor-pointer"
          }
          aria-label={isCurrent ? `Page ${pageNum} (current)` : `Go to page ${pageNum}`}
          aria-current={isCurrent ? "page" : undefined}
        >
          {pageNum}
        </a>
      );
    })}
  </div>

  <!-- Next Button -->
  {nextUrl ? (
    <a
      href={nextUrl}
      class="flex items-center justify-center px-2.5 sm:px-3 h-10 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-black dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors cursor-pointer"
      aria-label="Next page"
    >
      <span class="hidden sm:inline">Next</span>
      <svg class="w-3.5 h-3.5 sm:ms-2 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5h12m0 0L9 1m4 4L9 9"/>
      </svg>
    </a>
  ) : (
    <span
      class="flex items-center justify-center px-2.5 sm:px-3 h-10 text-sm font-medium text-gray-400 bg-gray-100 border border-gray-200 rounded-lg cursor-not-allowed dark:bg-gray-800 dark:border-gray-700 dark:text-gray-600"
      aria-disabled="true"
      aria-label="Next page (disabled)"
    >
      <span class="hidden sm:inline">Next</span>
      <svg class="w-3.5 h-3.5 sm:ms-2 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5h12m0 0L9 1m4 4L9 9"/>
      </svg>
    </span>
  )}
</nav>
